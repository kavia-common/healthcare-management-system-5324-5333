{"is_source_file": true, "format": "Python", "description": "This file defines API routes for managing consultations in a healthcare system. It includes endpoints for creating, listing, retrieving, and updating consultations, with appropriate access controls for patients and doctors. It uses FastAPI, Motor (async MongoDB driver), and custom models.", "external_files": ["src.api.auth", "src.api.db", "src.api.models"], "external_methods": ["decode_token", "get_db", "convert_object_ids", "to_object_id"], "published": ["create_consultation", "list_consultations", "get_consultation", "update_consultation"], "classes": [], "methods": [{"name": "Dict[str,Any] get_current_user(token: str = Depends(oauth2_scheme))", "description": "Decodes JWT token to get current user's claims.", "scope": "", "scopeKind": ""}, {"name": "_consultations(db: AsyncIOMotorDatabase)", "description": "Returns the 'consultations' collection from the database.", "scope": "", "scopeKind": ""}, {"name": "_patients(db: AsyncIOMotorDatabase)", "description": "Returns the 'patients' collection from the database.", "scope": "", "scopeKind": ""}, {"name": "_doctors(db: AsyncIOMotorDatabase)", "description": "Returns the 'doctors' collection from the database.", "scope": "", "scopeKind": ""}, {"name": "Any create_consultation( payload: ConsultationCreate, user: Dict[str, Any] = Depends(get_current_user), db: AsyncIOMotorDatabase = Depends(get_db), )", "description": "Creates and schedules a new consultation, validating patient and doctor references.", "scope": "", "scopeKind": ""}, {"name": "Any list_consultations( user: Dict[str, Any] = Depends(get_current_user), db: AsyncIOMotorDatabase = Depends(get_db), skip: int = Query(0, ge=0), limit: int = Query(50, ge=1, le=200), )", "description": "Lists consultations for the current user, filtered by role (patient or doctor).", "scope": "", "scopeKind": ""}, {"name": "Any get_consultation( id: str = Path(..., description=\"Consultation id\"), user: Dict[str, Any] = Depends(get_current_user), db: AsyncIOMotorDatabase = Depends(get_db), )", "description": "Retrieves details of a specific consultation, with access control based on user role.", "scope": "", "scopeKind": ""}, {"name": "Any update_consultation( id: str, payload: ConsultationUpdate, user: Dict[str, Any] = Depends(get_current_user), db: AsyncIOMotorDatabase = Depends(get_db), )", "description": "Allows a doctor to update an existing consultation.", "scope": "", "scopeKind": ""}], "calls": ["decode_token", "get_db", "convert_object_ids", "to_object_id", "HTTPException", "status.HTTP_401_UNAUTHORIZED", "status.HTTP_403_FORBIDDEN", "status.HTTP_404_NOT_FOUND", "status.HTTP_422_UNPROCESSABLE_ENTITY", "coll.find_one", "coll.insert_one", "coll.find_one_and_update", "coll.find", "async for doc in cursor", "model_dump", "sort"], "search-terms": ["consultations", "Scheduling API", "MongoDB consultations collection", "role-based consultation access", "FastAPI consultations endpoints"], "state": 2, "file_id": 13, "knowledge_revision": 29, "git_revision": "", "ctags": [{"_type": "tag", "name": "_consultations", "path": "/home/kavia/workspace/code-generation/healthcare-management-system-5324-5333/fastapi_backend/src/api/routes/consultations.py", "pattern": "/^async def _consultations(db: AsyncIOMotorDatabase):$/", "language": "Python", "kind": "function", "signature": "(db: AsyncIOMotorDatabase)"}, {"_type": "tag", "name": "_doctors", "path": "/home/kavia/workspace/code-generation/healthcare-management-system-5324-5333/fastapi_backend/src/api/routes/consultations.py", "pattern": "/^async def _doctors(db: AsyncIOMotorDatabase):$/", "language": "Python", "kind": "function", "signature": "(db: AsyncIOMotorDatabase)"}, {"_type": "tag", "name": "_patients", "path": "/home/kavia/workspace/code-generation/healthcare-management-system-5324-5333/fastapi_backend/src/api/routes/consultations.py", "pattern": "/^async def _patients(db: AsyncIOMotorDatabase):$/", "language": "Python", "kind": "function", "signature": "(db: AsyncIOMotorDatabase)"}, {"_type": "tag", "name": "create_consultation", "path": "/home/kavia/workspace/code-generation/healthcare-management-system-5324-5333/fastapi_backend/src/api/routes/consultations.py", "pattern": "/^async def create_consultation($/", "language": "Python", "typeref": "typename:Any", "kind": "function", "signature": "( payload: ConsultationCreate, user: Dict[str, Any] = Depends(get_current_user), db: AsyncIOMotorDatabase = Depends(get_db), )"}, {"_type": "tag", "name": "get_consultation", "path": "/home/kavia/workspace/code-generation/healthcare-management-system-5324-5333/fastapi_backend/src/api/routes/consultations.py", "pattern": "/^async def get_consultation($/", "language": "Python", "typeref": "typename:Any", "kind": "function", "signature": "( id: str = Path(..., description=\"Consultation id\"), user: Dict[str, Any] = Depends(get_current_user), db: AsyncIOMotorDatabase = Depends(get_db), )"}, {"_type": "tag", "name": "get_current_user", "path": "/home/kavia/workspace/code-generation/healthcare-management-system-5324-5333/fastapi_backend/src/api/routes/consultations.py", "pattern": "/^async def get_current_user(token: str = Depends(oauth2_scheme)) -> Dict[str, Any]:$/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "(token: str = Depends(oauth2_scheme))"}, {"_type": "tag", "name": "list_consultations", "path": "/home/kavia/workspace/code-generation/healthcare-management-system-5324-5333/fastapi_backend/src/api/routes/consultations.py", "pattern": "/^async def list_consultations($/", "language": "Python", "typeref": "typename:Any", "kind": "function", "signature": "( user: Dict[str, Any] = Depends(get_current_user), db: AsyncIOMotorDatabase = Depends(get_db), skip: int = Query(0, ge=0), limit: int = Query(50, ge=1, le=200), )"}, {"_type": "tag", "name": "oauth2_scheme", "path": "/home/kavia/workspace/code-generation/healthcare-management-system-5324-5333/fastapi_backend/src/api/routes/consultations.py", "pattern": "/^oauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"\\/auth\\/login\", scheme_name=\"JWT\")$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/healthcare-management-system-5324-5333/fastapi_backend/src/api/routes/consultations.py", "pattern": "/^router = APIRouter($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "update_consultation", "path": "/home/kavia/workspace/code-generation/healthcare-management-system-5324-5333/fastapi_backend/src/api/routes/consultations.py", "pattern": "/^async def update_consultation($/", "language": "Python", "typeref": "typename:Any", "kind": "function", "signature": "( id: str, payload: ConsultationUpdate, user: Dict[str, Any] = Depends(get_current_user), db: AsyncIOMotorDatabase = Depends(get_db), )"}], "hash": "9b37a5b9d0223c7897975f79be460315", "format-version": 4, "code-base-name": "fastapi_backend", "filename": "fastapi_backend/src/api/routes/consultations.py", "fields": [{"name": "oauth2_scheme = OAuth2PasswordBearer(tokenUrl=\"\\/auth\\/login\", scheme_name=\"JWT\")", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "router = APIRouter(", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"29": ""}]}